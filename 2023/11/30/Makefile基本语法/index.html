<div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-11-30T09:27:44.013Z" title="11/30/2023, 5:27:44 PM">2023-11-30</time>发表</span><span class="level-item"><time dateTime="2023-11-30T09:27:44.013Z" title="11/30/2023, 5:27:44 PM">2023-11-30</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Android%E6%8A%80%E6%9C%AF/">Android技术</a></span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">Makefile基本语法</h1><div class="content"><h2 id="Makefile-通过-文件生成时间-来判断文件是否有被修改过-，-进而判断文件是否需要重新编译"><a href="#Makefile-通过-文件生成时间-来判断文件是否有被修改过-，-进而判断文件是否需要重新编译" class="headerlink" title="Makefile 通过 文件生成时间 来判断文件是否有被修改过 ， 进而判断文件是否需要重新编译"></a>Makefile 通过 文件生成时间 来判断文件是否有被修改过 ， 进而判断文件是否需要重新编译</h2><ol>
<li>如果工程没有被编译过，则所有C文件编译并被链接</li>
<li>若工程中某几个文件被修改，则单独编译这几个文件，并重新链接</li>
<li>若头文件.h 被修改</li>
</ol>
<span id="more"></span>
<p><img src="/images/Makefile%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/1.png"></p>
<h1 id="Make-命令-执行流程："><a href="#Make-命令-执行流程：" class="headerlink" title="Make 命令 执行流程："></a>Make 命令 执行流程：</h1><ol>
<li>Make 会在当前目录下按顺序寻找GNUmakefile , makefile , Makefile</li>
<li>若未找到则报错，若找到 则把第一个目标作为最终目标</li>
<li>按照堆栈顺序，以此找到每一个目标文件，判断新旧，必要时重新生成目标文件，直到生成最终目标（可执行文件）</li>
<li>寻找过程中，若某个依赖不存在，则直接退出，报错</li>
<li>标号不会被关联到，必须通过命令行参数才能执行（如 clean）</li>
<li>若改变了源文件或头文件，相关联的目标文件都需要重新编译，直接输入make即可</li>
</ol>
<h1 id=""><a href="#" class="headerlink" title=""></a></h1><p>.PHONY:<br>表示伪目标，如clean,用.PHONY声明后，以后有了真的clean编译命令，也不会发生错误。（伪目标clean是清空，make clean ，需要命令行输入命令执行; 编译命令clean 是如main.c 一样的）</p>
<h2 id="Makefile-书写简化："><a href="#Makefile-书写简化：" class="headerlink" title="Makefile 书写简化："></a>Makefile 书写简化：</h2><ol>
<li>相同部分用引用代替<br><img src="/images/Makefile%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/2.png"></li>
<li>所有文件共同依赖的文件单独列出<br><img src="/images/Makefile%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/3.png"></li>
<li>其他目标文件只列出个性依赖<br><img src="/images/Makefile%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/4.png"></li>
</ol>
<h2 id="Makefile-设计方法"><a href="#Makefile-设计方法" class="headerlink" title="Makefile  设计方法"></a>Makefile  设计方法</h2><ol>
<li>隐含规则<br>2.生成多个文件</li>
<li>Makefile嵌套</li>
<li>使用变量</li>
<li>使用函数</li>
</ol>
<h4 id="1-隐含规则（当-make-r-则禁止使用任何隐含规则）"><a href="#1-隐含规则（当-make-r-则禁止使用任何隐含规则）" class="headerlink" title="1. 隐含规则（当 make -r 则禁止使用任何隐含规则）"></a>1. 隐含规则（当 make -r 则禁止使用任何隐含规则）</h4><p><img src="/images/Makefile%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/5.png"><br>（例）自动扩展<br>如<br>main. : main.o  foo.o<br>cc -o foo foo.o bar.o<br>main依赖于foo.o,但是我们没有写foo.c生成foo.o  此时make会自动利用语法帮我们生成foo.o</p>
<h4 id="2-同时生成多个可执行文件"><a href="#2-同时生成多个可执行文件" class="headerlink" title="2. 同时生成多个可执行文件"></a>2. 同时生成多个可执行文件</h4><p><img src="/images/Makefile%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/6.png"><br>这样可同时生成 P1 P2 P3三个可执行程序<br>（ 当makefile 命令出错时，make 会直接中断返回，在命令前加上- ，则当这条命令报错时，可以让make忽略，继续执行下面的命令）</p>
<h4 id="3-Makefile-嵌套执行"><a href="#3-Makefile-嵌套执行" class="headerlink" title="3.    Makefile 嵌套执行"></a>3.    Makefile 嵌套执行</h4><p><img src="/images/Makefile%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/7.png"><br><img src="/images/Makefile%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/8.png"><br>@代表执行时“静悄悄”，不输出执行信息</p>
<h4 id="4-使用变量"><a href="#4-使用变量" class="headerlink" title="4. 使用变量"></a>4. 使用变量</h4><p>Makefile中可以使用变量，类似于C语言中的宏，但值可以修改<br>变量大小写敏感<br>变量名 不应包含 ：# &#x3D; 或者空格<br>使用变量时用$(var)的形式</p>
<h3 id="变量的两种方式："><a href="#变量的两种方式：" class="headerlink" title="变量的两种方式："></a>变量的两种方式：</h3><h4 id="（1）-递归展开变量"><a href="#（1）-递归展开变量" class="headerlink" title="（1） 递归展开变量"></a>（1） 递归展开变量</h4><p>使用“&#x3D;”表示，可先使用，后定义<br>（弊病：有可能递归定义，造成无限展开）</p>
<h4 id="（2）-简单展开变量"><a href="#（2）-简单展开变量" class="headerlink" title="（2） 简单展开变量"></a>（2） 简单展开变量</h4><p>使用“：&#x3D;”表示，须先定义，再使用<br>（：&#x3D; 作用为 取当前赋值的上一个如：<br>a &#x3D; 3<br>b &#x3D; a<br>a &#x3D; 4<br>则输出b的值为3<br>）</p>
<h4 id="（3）系统环境变量"><a href="#（3）系统环境变量" class="headerlink" title="（3）系统环境变量"></a>（3）系统环境变量</h4><p><img src="/images/Makefile%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/9.png"></p>
<h4 id="（4）-自动化变量"><a href="#（4）-自动化变量" class="headerlink" title="（4） 自动化变量"></a>（4） 自动化变量</h4><p><img src="/images/Makefile%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/10.png"></p>
<h4 id="（5）-预定义变量"><a href="#（5）-预定义变量" class="headerlink" title="（5） 预定义变量"></a>（5） 预定义变量</h4><p><img src="/images/Makefile%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/11.png"></p>
<h4 id="（6）函数"><a href="#（6）函数" class="headerlink" title="（6）函数"></a>（6）函数</h4><p><img src="/images/Makefile%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/12.png"></p>
</div><div class="article-licensing box"><div class="licensing-title"><p>Makefile基本语法</p><p><a href="http://example.com/2023/11/30/Makefile基本语法/">http://example.com/2023/11/30/Makefile基本语法/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>lx</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2023-11-30</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2023-11-30</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2023/11/30/ANDROID%20property%20%E5%8F%82%E6%95%B0%E7%AE%80%E4%BB%8B/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Android Property参数简介</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2023/11/30/AudioTrack%E6%A6%82%E8%BF%B0/"><span class="level-item">AudioTrack概述</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div class="content" id="valine-thread"></div><script src="//cdn.jsdelivr.net/npm/leancloud-storage@3/dist/av-min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/valine/1.4.16/Valine.min.js"></script><script>new Valine({
            el: '#valine-thread',
            appId: "dB8Dj4QSAc3XtpuM6sS4fCKR-gzGzoHsz",
            appKey: "xrxrySOXhneb2IHjGP1lHSx3",
            
            avatar: "mm",
            avatarForce: false,
            meta: ["nick","mail","link"],
            pageSize: 10,
            lang: "zh-CN",
            visitor: false,
            highlight: true,
            recordIP: false,
            
            
            
            enableQQ: false,
            requiredFields: [],
        });</script></div></div>